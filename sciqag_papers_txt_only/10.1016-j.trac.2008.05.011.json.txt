Gas chromatography (GC) is a very powerful separation technique for multifactor mixtures of analytes. An ideal chromatographic experiment leads to perfect separation of these chemical analytes. The resolving power can be increased when mass spectrometry (MS) is coupled to GC, since the MS dimension provides additional resolving power compared to traditional detectors such as the flame ionization detector (FID) . The high sensitivity, the low limit of detection, the possibility of analyzing a great number of analytes and identifying these using the mass spectra, makes GC-MS one of the most widespread analytical techniques in many scientific fields. Several excellent reviews have recently been published showing the possibilities and the limitations of GC-MS in biological matrices , geological and forensic research , environmental matrices , proteomics and metabonomics .
However, analysis of GC-MS data is sometimes hampered by different problems, mainly derived from the chromatographic separation and/or MS measurements. Sometimes, it is impossible to achieve perfect separation, because the samples are complex or faster chromatographic runs are preferred. Also, problems with baseline drift, changes in the shapes of peaks and shifts in elution times may decrease the quality of the final result of the analysis . Traditionally, the use of, for example, one or more standards help to control and to locate some of these problems. However, the capability of internal standards is limited in more severe cases of baseline drift and changes in the shapes of peaks.
Due to the complexity of the samples often measured using GC-MS, standard data-analysis tools from instrument vendors are insufficient for extracting all the relevant information from such data. A more versatile methodology is needed for the analysis of the datasets to provide results that can be plotted in an easy, comprehensive way.
Several mathematical methods have already been proposed to correct for undesirable phenomena introduced during the chromatographic run . Unfortunately, the use of advanced data analysis focusing on detailed analysis of GC-MS data is not widespread. For example, the Correlation Optimized Warping (COW) algorithm has shown promise in handling elution-time shifting due to its peak shape and area-preserving properties . Skov et al. put forward an interesting approach for how to choose the best conditions for applying the COW algorithm in correcting elution-time shifts while preserving peak shapes However, COW does not allow correcting artifacts (e.g., varying baseline or severe overlapping peaks) and can introduce artifacts if peak-shape changes are observed across samples.
When a GC-MS measurement is performed, a two-way matrix is obtained for each sample (Fig. 1 a). The matrix corresponding to the kth sample, X k, is of dimensions I × J, where the columns represent each of the length, I, mass spectra for each of the J elution times (rows). A three-way structure is obtained when measurements from a set of samples are obtained and stacked (Fig. 1b). The cube of data will be X(I × J × K).
In the past 10 years, there has been increased focus on taking advantage of this three-way structure of GC-MS data, or of any other hyphenated chromatographic techniques (e.g., LC-MS or HPLC-UV). This has been made possible by the improvement in data acquisition and the power of personal computers. Models used include Multivariate Curve Resolution-Alternating Least Squares in the unfolded way (MCR-ALS) , Generalized Rank Annihilation Method (GRAM) and PARAllel FACtor analysis (PARAFAC) .
The first general solution for handling the overlapping-peaks problem was GRAM by Sánchez and co-workers . This method was a generalization of the method Rank Annihilation Factor Analysis (RAFA) of Ho and co-workers , mainly used for quantification. The main feature of GRAM is that it works even with only two samples. The first sample usually holds the chromatographic profile of a mixture containing known standard(s) and the second contains the analytes whose profiles overlap.
RAFA and GRAM have the serious drawback that they can be used only in cases of a single standard and a single unknown mixture. Hence, the results rely heavily on the quality of the two samples, and no additional benefits can be gained from having more samples. To overcome this problem, Sánchez and co-workers developed the Direct Trilinear Decomposition (DTLD) algorithm , which is an extension of GRAM for more than two samples. DTLD decomposes the data into three matrices, containing the elution profiles, the mass spectra and quantitative information about each of the components in each sample. Both GRAM and DTLD are efficient when the data are well approximated by the underlying model, but they are often too sensitive to minor deviations (e.g., caused by retention-time shifts).
The PARAFAC model is probably the most widespread multi-way method in chromatography. PARAFAC decomposes the three-way array into three matrices, called loading matrices, one for each mode. For the sample mode, the loading matrix is usually referred to as a score matrix and holds the relative concentration of each chemical compound in the sample if the model successfully separates the individual chemical compounds into individual PARAFAC factors. The elution-mode loading matrix correspondingly holds the estimated elution profiles of each analyte and the last mode, the estimated mass spectra of each factor.
The major problem with GRAM, DTLD and PARAFAC relates to the intrinsic structure of the data array that these models can handle. The models all assume that the elution profiles and the mass spectra remain invariant (i.e. same profile) for all the samples (i.e. the data set is low-rank trilinear and that data from each analyte have a rank-one contribution to the data) . In an ideal situation, this assumption will be valid. Nevertheless, this assumption is often far from reality due to different sources of variability in the elution-time mode of GC-MS data. Consequently, trilinearity of the data is disturbed, especially due to changes in the elution-time mode (Table 1 ).
One method that allows a certain freedom in chromatographic profiles is the MCR-ALS . Here, analysis is performed by unfolding the three-way array in the chromatographic direction, while keeping the MS dimension intact. The main advantage of MCR-ALS is that it can also handle non-trilinear data. Nevertheless, MCR-ALS greatly depends on the initial estimates of input parameters (elution and MS profiles) and the three-way information is lost in the unfolding stage. This implies that it is impossible to recover estimates of the signal from the underlying analytes unless certain requirements are fulfilled.
Like PARAFAC, PARAFAC2 also decomposes three-way data arrays into loading matrices, but the main difference is that PARAFAC2 does not impose such strong restrictions on the data structure . PARAFAC2 does not assume that the shape (or even length) of the elution profile of an analyte is the same in each sample (Table 1). This property has allowed the use of the PARAFAC2 model in such diverse fields as sensor-based data , semiconductor production , HPLC-DAD , kinetic spectrophotometric analysis , modeling of flavor release and analytical dilution systems . Even though PARAFAC2 allows elution profiles to differ in shape in different samples, it still possesses uniqueness properties that are very similar to those of PARAFAC . This means that, if a successful model is obtained, PARAFAC2 can separate mixture data into the contributions (concentrations, elution profiles and mass spectra) of the underlying analytes directly. PARAFAC2 could be an ideal technique for modeling GC-MS data, as the model allows one elution-time profile to be obtained for each factor of the sample, taking into consideration that each analyte has a mass spectrum that is consistent across all samples. Excellent examples of the use of PARAFAC2 in GC-MS can be found. For example, in the work of Cruz et al., calibration models were developed with PARAFAC2 for the quantification of five hormonal growth promoters and of several steroidal hormones , and similar results obtained compared to an internal-standard calibration in terms of figures of merits. Also, in the work of Hibbert et al. , PARAFAC2 was applied to classify different weathered oils. Nevertheless, as Skov et al. stated, further investigations are needed to establish fully the usefulness of PARAFAC2 in modeling GC-MS data.
This article is a comprehensive overview of several problems in GC-MS (e.g., severe shifts in retention time, overlapping peaks, baseline drift and low-intensity peaks) and how PARAFAC2 can handle these. The article also highlights possible limitations in using PARAFAC2.
Three-way chromatographic data can be arranged in such a way that the first mode refers to mass channels, the second mode to elution times and the third mode to samples (Fig. 1b).
The PARAFAC2 model allows that every sample can have its own distinct set of elution-time loadings . Each sample (each slab of X) X k(I × J) is modeled as indicated in Equation (1) (Fig. 2 ). Xk=ADk(Bk)T+Ek;k=1,..,K where X k(I × J) represents the chromatographic run related to the kth sample. A (I × F) holds the resolved mass spectra of the F analytes. D k (F×F) is a diagonal matrix that holds the kth row of the sample-mode loading matrix C. Each element in this row is the relative concentration of analyte f. Matrix B k(I×F) ideally holds an estimate of the individual elution profiles for each of the F factors. Matrix E k represents the residuals.
An important constraint in PARAFAC2 is that the cross-product of B k has to be constant over all the samples (Equation (2)). This constraint is needed to obtain uniqueness. The implication of this cross-product constraint is that the elution profiles in different experiments may differ (e.g., due to shifting), but should still be somewhat similar. (B1)T(B1)=(B2)T(B2)=…=(Bk)T(Bk) Fig. 2 illustrates the decomposition of the three-way array X. Detailed information about the model and algorithms is available .
The data used here comprise GC-MS landscapes of 24 samples of red wines of different origin (Fig. 3 ) . A dynamic headspace-GC-MS (HS-GC-MS) system was used to measure the aroma profile of the wine samples. More information about the collection and the experimental set-up of the samples is available .
Typical GC-MS problems are reflected in the data (e.g., severe changes in the shape of several peaks, severe shift in elution time, low intensity of peaks, baseline drift and overlapping peaks). Five areas of the data set were selected to reflect these problems (highlighted in solid squares in Fig. 3).
Currently, software for computing PARAFAC2 models is available from two sources. The first can be freely downloaded from the Internet . The second can be obtained from Eigenvector Research and is implemented in PLS_Toolbox v. 4.1 . Both algorithms work in Matlab (The Mathworks, Inc. 2008). For this article, we used PARAFAC2 from PLS_Toolbox v. 4.1.
From an analytical point of view, the estimated mass spectra as well as their corresponding concentrations cannot be negative, so non-negativity constraints were imposed for sample and MS loadings. In the PARAFAC2 algorithm available and used in this work , it is impossible to impose non-negativity constraints on the elution profiles, even though this would also be appropriate.
The selection of the correct number of factors is the most important aspect of the model in applying PARAFAC2. Because of the nature of the model, all parameter estimates (e.g., estimated elution profiles) depend on each other, so the correct number of factors must be used. Otherwise, the parameters will, at worst, be chemically meaningless, even though they are uniquely determined mathematically. In this article and in chromatographic analysis in general, it is advisable to resolve chromatographic peaks individually, hence to work on a small window or region of the elution-time dimension. That way, the quality of the models will be better, because indirect and direct correlations between different compounds do not affect the modeling and because the problem of choosing the number of factors is typically simplified significantly.
In the following, the number of factors was determined by assessing the explained variance for the model (Equation (3)) as well as scrutinizing the appearance of the parameters and the residuals. The explained variance was calculated as follows: %var=100×1-SSESSX where SSE is the sum of the squares of the residuals and SSX is the sum of the squares of the elements of the three-way array. Furthermore, visual interpretation of the results (such as residuals) was used to guide the selection.
All the MS loadings obtained were scaled in order to compare with experimental mass spectra. The experimental mass spectra were obtained from a run of the pure analyte, if this was identified from the chromatographic software. Otherwise, we used an average of all mass spectra from all scans constituting an individual peak. We made the comparison by calculating the similarity between the experimental mass spectrum and the calculated loading. This was calculated as follows: fit(%)=100×1-∑xi-xi⌢2∑xi2 where xi corresponds to the intensity for m/z equal to i for the experimental spectrum and xi⌢ corresponds to the appropriate loading. The Wiley Library for identification of analytes in ChemStation was used to identify the structure of each analyte according to the experimental mass spectrum and the MS loading obtained with PARAFAC2.
The peaks in region “a” of the chromatogram (Fig. 3a) represent the classical problem of shifts in elution time. This is a well-defined peak, with high intensity (high signal-to-noise ratio). The peak of one sample is severely shifted but all the remaining ones are also shifted.
Fig. 4 shows results obtained with PARAFAC2. In this situation, it is easy to see that the PARAFAC2 model has to be developed with only one factor. As expected, PARAFAC2 is able to model the chromatogram of the peak for each sample (Fig. 4a).
Fig. 4b shows the relative concentration loading obtained for each sample. This concentration-loading value is an estimate of the area under each chromatographic peak. It can be used for calibration models for the analyte of interest. The mass spectrum obtained with PARAFAC2 perfectly matches the one obtained experimentally. The similarity is 99.9%.
Fig. 4c compares the mass spectrum obtained with PARAFAC2 (upper) and the real mass spectra (bottom). This peak was identified as acetic-acid ethyl ester .
The second region selected appears between scan 2635 and 2695. Looking at the enlargement in the inset (Fig. 3b), it is difficult to assess the number of analytes present because of the overlaps, shifts and baseline drift.
At first, there seems to be only two slightly overlapping peaks. The explained variance of a PARAFAC2 model with two factors is 97.25%, which is on the low side for data such as these (Table 2 ). The residuals of this model trends present that may indicate that two factors are not enough to explain the systematic variation in the data, probably due to a baseline effect reflected in the background mass spectrum. A PARAFAC2 model with three factors explains more than 99%. Fig. 5 a and b show the chromatographic loadings and the relative concentrations for factor 1 (solid), factor 2 (dashed) and, what is more important, for the background (dotted).
The two chemical analytes have been identified as acetic acid-hexyl ester (Fig. 5c) and 3-hydroxy-2-butanone (Fig. 5d), respectively. The background signal is most probably due to column bleeding, so it has a specific and consistent mass spectrum within the narrow elution-time window investigated and from this can be described in one PARAFAC2 factor (Fig. 5e). The chromatographic loadings are perfectly defined for each sample, handling the problems of shifts within elution-time profiles and across the samples, overlapping of peaks and baseline drift. The elution-time loading for the background (Fig. 5a) shows how the influence of the background remains almost constant throughout the different samples.
The similarity between the background mass spectrum obtained with PARAFAC2 and the mass spectrum obtained experimentally (electron-impact (EI) mass spectrum obtained from ) is more than 99.8%. The similarities for factor 1 and factor 2 mass spectra are 95.5% and 98.9%, respectively.
We need to point out that the shape of the chromatographic loading for one sample (red, Fig. 5a) does not have a very well-defined shape. This is merely an artifact due to the way the elution profiles are presented. As can be seen in the concentration mode (red circle, Fig. 5b), the concentration is approximately zero in the sample, so the (normalized) elution profile is not well defined.
The next two examples are devoted to showing how PARAFAC2 can help to obtain the mass spectrum of an analyte whose signal-to-noise ratio is very low. Qualitative as well as quantitative analysis is then difficult, because the mass spectrum of the analyte is greatly affected by the background mass spectrum. The elution-time regions between 4340 and 4390 scans (Fig. 3c) and 5500 and 5700 scans (Fig. 3d) reflect problems encountered with low-intensity peaks. Such areas are often not studied because of the low quality of the signal and the high interference of the baseline drift.
The first case (Fig. 3c) again reflects the situation where some analytes are absent in some samples, and the peak is greatly affected by the background interference, and that causes low signal-to-noise ratios. As can be expected, PARAFAC2 allows modeling of the chromatographic profile even if there is no analyte (Table 2, Fig. 6 a). The estimated mass spectrum obtained for factor 1 identifies the peak as ethyl dec-9-enoate (Fig. 6c), and the chromatographic loading reflects that there are two samples with a concentration of the analyte close to zero (Fig. 6a and b). Once again, the similarity between mass spectrum obtained for background and the experimental one is above 99.5%.
In the second case (Fig. 3d), the peak of the analyte, which is perfectly separated from the background using two factors, is obtained using PARAFAC2 (Fig. 7 a and b). In this case, the chromatographic peak was identified as a common contaminant in GC-MS analysis, bis-(2-ethylhexyl)phthalate (Fig. 7c). The mass spectrum obtained for the background perfectly matches the experimental one (similarity above 99.5%).
As shown above, PARAFAC2 has a remarkable ability to extract chemical information even in cases of low-intensity signals. Nevertheless, we also need to mention and study situations where the model cannot handle the chromatographic data.
Apart from the time for model calculation (that can be minutes to hours on current state-of-the-art personal computers), the main problem of PARAFAC2 is the need to determine the correct number of factors.
An example of the difficulty in determining the number of factors can be found in the area between scans 2100 and 2500 (Fig. 3e). Apparently, there are two peaks in this elution-time interval, so a PARAFAC2 model with two factors would be expected to model both peaks (maybe three if baseline is modeled as well). Nevertheless, the chromatographic loadings obtained for the model with two factors are very different from those expected (results not shown). The first factor involves both peaks, whereas the second factor seems to be an artifact of the mathematical model. This result may indicate an incorrect number of factors were chosen, and both peaks may belong to the same analyte, but in isomeric forms. Nevertheless, these peaks were identified as isoamyl alcohol and hexanoic acid ethyl ester, respectively. The mass spectra of these analytes are indeed different.
Further analysis of the raw data between 2250 and 2350 scans indicated that the mass spectrum obtained at scan 2306 (Fig. 8 a) and scan 2325 (Fig. 8b) for sample 1 (as an example) differ in shape. Ideally, all the mass channels have to increase in intensity in the second scan with respect to the first. Nevertheless, there are several mass channels that decrease in intensity (e.g., channels m/z 53 and 54). This may be caused by a perfect co-elution problem of several analytes at low concentration. As mentioned above, the peak was identified as isoamylic alcohol (3-methyl-butanol). It is well known that isomeric forms of methyl-butanol can co-elute .
A PARAFAC2 model with two and three factors was fitted to the first peak, obtaining models that explained 99.5% and more than 99.9% of the total variance, respectively (Fig. 9 , Table 2). The model with two factors seems to indicate that, effectively, the co-elution of, at least, two isomeric forms of methyl-butanol occurs (Fig. 9a). The dashed peak was identified as isoamylic alcohol (3-methyl-butanol); whereas the dotted peak was identified as 2-methyl-butanol.
Despite the apparent success of the model, several problems still remain (red-marked samples). The elution profiles obtained for the PARAFAC2 model with three factors (Fig. 9b) allow clear identification of 3-methyl-butanol (dotted) and 2-methyl-butanol (dashed), having a very well-defined shape. Furthermore, a third factor has been modeled (solid). The profile of its mass spectrum is highly correlated with the mass spectrum of 3-methyl-butanol. This may indicate that, apart from the co-elution problem, other variability sources exist in the raw dataset that do not allow a fully satisfactory PARAFAC2 model to be obtained.
We have demonstrated that PARAFAC2 is a powerful tool for solving problems derived from experimental variability in GC-MS data. The variance explained in all models was above 99%. The mass spectra obtained matched the real mass spectra, even for the background and for analytes of very low intensity, and even where standard chromatographic software would not have been able to provide meaningful results.
PARAFAC2 handled problems, such as baseline drifts, differently shaped peaks, overlapping peaks or even low signal-to-noise ratios. This capability and the uniqueness property of the mass spectra allow PARAFAC2 to resolve low-intensity peaks so that MS loadings can be used for qualitative purposes (identification) and that the relative concentration obtained can be used for quantitative determination of the analytes.
The technique that we have presented can also be used for other hyphenated separation techniques (e.g., HPLC-UV and LC-MS), where peak shift, peak-shape changes and baseline contributions are often even bigger issues.